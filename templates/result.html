<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      .roi {
        position: absolute;
        background-color: transparent;
        border: solid 1px yellow;
        width: 0px;
        height: 0px;
        left: 0px;
        top: 0px;
      }

      .label {
        position: absolute;
        margin-top: -20px;
        color: #ffffff;
      }
    </style>

    <script type=text/javascript src="{{ url_for('static', filename='jquery-3.1.0.min.js') }}"></script>
    <script type="text/javascript">
      function drawRect(x, y, w, h) {
        var dom = $("<div class='roi'>");
        dom.appendTo($("#canvas"));
        dom.css('left', x);
        dom.css('top', y);
        dom.width(w);
        dom.height(h);
      }

      function drawLabel(x, y, text, score) {
        if (y < 20) {
          // 画面からはみ出ないようにオフセットつける
          y += 20;
        }
        console.log(y);
        var dom = $("<span class='label'>");
        dom.appendTo($("#canvas"));
        dom.css('left', x);
        dom.css('top', y);
        dom.html(text + ': ' + score);
      }

      $(function() {
        $.ajax({
          type: "GET",
          url: "/rcnn.json",
          dataType: 'json'
        }).done(function( data ) {
          var img_width = data.width;
          var img_height = data.height;
          var results = data.result;

          var scaling = $("#image").height() / img_height;

          for (var i = 0; i < results.length; i += 1) {
            var x = results[i].roi[0];
            var y = results[i].roi[1];
            var w = results[i].roi[2];
            var h = results[i].roi[3];
            var label = results[i].result[0];
            var label_text = label.label;
            var label_score = label.score;

            x *= scaling;
            y *= scaling;
            w *= scaling;
            h *= scaling;

            if (label_score > 0.1) {
              drawRect(x, y, w, h);
              drawLabel(x, y, label_text, label_score);
            }
          }
          $("#result").hide();
        });
      });
    </script>
  </head>
  <body>
    <div style="position:relative;">
      <div id="canvas">
        <img id="image" src="/image" height="400">
      </div>
    </div>
    <div id="result">
      Processing... This takes for a while. Please wait.
    </div>
    <br/>
    <div>
      <a href='/'>Back</a>
    </div>
  </body>
</html>
